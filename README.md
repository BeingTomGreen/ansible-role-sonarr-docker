# beingtomgreen.sonarr_docker

A simple ansible role for running [Sonarr](https://sonarr.tv/) via Docker compose using the [LinuxServer.io Sonarr image](https://docs.linuxserver.io/images/docker-sonarr).

For additional information on how to best handle your media paths see information on [wiki.servarr.com](https://wiki.servarr.com/docker-guide#consistent-and-well-planned-paths) and [trash-guides.info](https://trash-guides.info/File-and-Folder-Structure/Hardlinks-and-Instant-Moves/).

## Installation

Given that Galaxy seems to have abandoned roles, I suggest referencing this repository directly in your projects `requirements.yml`:

```yaml
---

roles:
  - name: beingtomgreen.sonarr_docker
    src: https://github.com/BeingTomGreen/ansible-role-sonarr-docker.git

collections: []
```

You can then install it alongside your other requirements as normal:

```bash
ansible-galaxy install -r requirements.yml
```

## Example usage

### Basic usage

```yaml
---

- hosts: sonarr
  become: true
  vars:
    # The environment attribute defines environment variables set in the container.
    sonarr_docker_environment:
      PUID: 1000
      PGID: 1000
      TZ: 'Etc/UTC'

    # Specifies the image to start the container from. Must follow the Open Container Specification addressable image format, as [<registry>/][<project>/]<image>[:<tag>|@<digest>].
    sonarr_docker_image: "lscr.io/linuxserver/sonarr:latest"

    # Defines the policy that the platform applies on container termination.
    sonarr_docker_restart_policy: 'unless-stopped'

    # The volumes attribute define mount host paths or named volumes that are accessible by service containers.
    sonarr_docker_volumes:
      - "{{ sonarr_docker_base_directory }}/config:/config"
      - '/path/to/tv:/tv'
      - '/path/to/downloads:/downloads'

  roles:
    - role: beingtomgreen.sonarr_docker
```

### Want the kitchen sink?

Seriously, take a look at [`defaults/main.yml`](defaults/main.yml), it's obnoxiously commented, just for you.

```yaml
---

- hosts: sonarr
  become: true
  vars:
    # Defines the containers service name
    sonarr_docker_service_name: "sonarr"

    # User that will own the compose files
    sonarr_docker_user: "{{ ansible_user }}"

    # Base path for deployment
    sonarr_docker_base_directory: '/opt/sonarr_docker'

    # Define the number of (potentially virtual) CPUs to allocate to service containers. This is a fractional number. 0.000 means no limit.
    sonarr_docker_cpus: 1.5

    # A string that specifies a custom container name, rather than a name generated by default.
    # Follows the regex format of [a-zA-Z0-9][a-zA-Z0-9_.-]+
    sonarr_docker_container_name: 'sonarr'

    # Defines custom DNS servers to set on the container network interface configuration. It can be a single value or a list.
    sonarr_docker_dns:
      - 8.8.8.8
      - 9.9.9.9

    # The environment attribute defines environment variables set in the container.
    sonarr_docker_environment:
      PUID: 1000
      PGID: 1000
      TZ: 'Etc/UTC'

    # Specifies the image to start the container from. Must follow the Open Container Specification addressable image format, as [<registry>/][<project>/]<image>[:<tag>|@<digest>].
    sonarr_docker_image: "lscr.io/linuxserver/sonarr:latest"

    # Configures a limit on the amount of memory a container can allocate, set as a string expressing a byte value.
    sonarr_docker_mem_limit: '250mb'

    # Sets a service container's network mode.
    sonarr_docker_networks: []

    # The ports is used to define the port mappings between the host machine and the containers.
    sonarr_docker_ports:
      - '8989:8989'

    # Defines the policy that the platform applies on container termination.
    sonarr_docker_restart_policy: 'unless-stopped'

    # The volumes attribute define mount host paths or named volumes that are accessible by service containers.
    sonarr_docker_volumes:
      - "{{ sonarr_docker_base_directory }}/config:/config"
      - '/path/to/tv:/tv'
      - '/path/to/downloads:/downloads'

  roles:
    - role: beingtomgreen.sonarr_docker
```

## Requirements

- Docker & docker compose installed on the target host
- ansible_user will also need to be in the docker group

## Dependencies

- community.docker

## License

[MIT](LICENSE)

## Author Information

[Tom Green](https://github.com/BeingTomGreen)
